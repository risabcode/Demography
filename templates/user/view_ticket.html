{% extends "base.html" %}
{% block title %}Ticket #{{ ticket.id }}{% endblock %}

{% block content %}
<div class=" bg-white p-6 rounded shadow">
  <div class="flex justify-between items-start">
    <div>
      <h2 class="text-xl font-bold mb-1">Ticket #{{ ticket.id }}</h2>
      <div class="text-sm text-gray-600">Submitted: {{ ticket.created_at }}</div>
      <div class="text-sm text-gray-600">Status: <span class="capitalize">{{ ticket.status }}</span></div>
    </div>
    <div>
      {% if current_user.role == 'admin' %}
        <a href="{{ url_for('admin_tickets') }}" class="text-sm text-gray-600 hover:underline">Back to admin tickets</a>
      {% else %}
        <a href="{{ url_for('user_dashboard') }}" class="text-sm text-gray-600 hover:underline">Back to dashboard</a>
      {% endif %}
    </div>
  </div>

  <div class="mt-4">
    <h3 class="font-semibold">Subject</h3>
    <div class="mt-1">{{ ticket.subject }}</div>
  </div>

  <div class="mt-4">
    <h3 class="font-semibold">Message</h3>
    <div class="mt-1 whitespace-pre-wrap">{{ ticket.message }}</div>
  </div>

  <div class="mt-4">
    <h3 class="font-semibold">Associated Form</h3>
    <div class="mt-1">
      {% if ticket.form_full_name %}
        <strong>{{ ticket.form_full_name }}</strong> (ID: {{ ticket.form_id }})
      {% else %}
        Form #{{ ticket.form_id }}
      {% endif %}
    </div>
  </div>

  <div class="mt-4">
    <h3 class="font-semibold">Admin Response</h3>
    <div class="mt-1">{{ ticket.admin_response or '-' }}</div>
  </div>

  {% if current_user.role == 'admin' %}
    <div class="mt-4">
      <form method="post" action="{{ url_for('admin_tickets') }}">
        <input type="hidden" name="ticket_id" value="{{ ticket.id }}">
        <label class="block">Status
          <select name="status" class="w-full border px-3 py-2 rounded">
            <option value="open" {% if ticket.status == 'open' %}selected{% endif %}>Open</option>
            <option value="in_progress" {% if ticket.status == 'in_progress' %}selected{% endif %}>In Progress</option>
            <option value="resolved" {% if ticket.status == 'resolved' %}selected{% endif %}>Resolved</option>
          </select>
        </label>
        <label class="block mt-2">Admin Response
          <textarea name="admin_response" class="w-full border px-3 py-2 rounded">{{ ticket.admin_response or '' }}</textarea>
        </label>
        <button class="mt-3 bg-green-600 text-white py-2 px-4 rounded">Save</button>
      </form>
    </div>
  {% endif %}

</div>
{% endblock %}
